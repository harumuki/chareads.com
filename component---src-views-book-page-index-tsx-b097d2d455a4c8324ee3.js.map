{"version":3,"sources":["webpack:///./src/components/RelatedBooks/index.tsx","webpack:///./src/views/BookPage/BookTitle.tsx","webpack:///./src/views/BookPage/BookImage.tsx","webpack:///./src/views/BookPage/BookReview.tsx","webpack:///./src/views/BookPage/TagsList/utils.ts","webpack:///./src/views/BookPage/TagsList/index.tsx","webpack:///./src/views/BookPage/BookMeta.tsx","webpack:///./src/views/BookPage/index.tsx","webpack:///./src/utils/urls/affiliates.ts","webpack:///./src/views/BookPage/BookAffiliates.tsx","webpack:///./node_modules/core-js/modules/es6.array.find.js","webpack:///./node_modules/core-js/modules/es7.object.values.js","webpack:///./src/components/links/Link/index.tsx","webpack:///./src/components/links/BackLink/index.tsx","webpack:///./src/components/icons/PlayIcon.tsx","webpack:///./src/components/cards/VideoCard/index.tsx"],"names":["StyledWrapper","styled","div","StyledGrid","Grid","FONT","SIZE","S","screen","l","RelatedBooks","books","featuredSlugs","ownedSlug","full","map","book","featured","slug","includes","key","id","span","spanFromM","spanFromL","hideDetails","StyledTitle","H","StyledAuthor","BookTitle","title","author","rating7","as","size","decorative","StarRating","of7","StyledBookImage","figure","BORDER_RADIUS","screenMax","m","toVW","MARGIN_COLUMNS","L","COLUMN_WIDTH","GAP","xl","XL","StyledImg","Img","screenMin","BookImage","image","bookHeight","style","background","colors","muted","fixed","childImageSharp","h200","media","BREAKPOINT","M","h300","h400","toFixed","backgroundColor","darkMuted","StyledBookReview","BookReview","summary","html","fontSize","dangerouslySetInnerHTML","__html","tagPrefixNames","type","genre","sub","StyledOl","ol","StyledLi","li","TagsList","tags","length","splitTags","resultMap","forEach","tag","parts","split","prefix","value","slice","join","push","Object","keys","filter","p","values","splitTagsByPrefix","StyledDt","dt","WEIGHT","BOLD","StyledDd","dd","BookMeta","pageCount","dateBookPublished","publisher","readDates","dateRated","dateReviewed","formatYear","shortFormatDate","StyledMeta","aside","StyledBookTitle","query","BookPage","data","timestampMentionData","featuredVideoData","location","timestampMentions","normalizeArray","featuredVideos","relatedBooks","Layout","BackLink","to","PATHS","BOOKS","GridItem","rows","rowsFromM","columnsFromM","columnsFromL","columnsFromXL","spanRowsFromM","Math","ceil","BookAffiliates","links","video","spanFromXL","VideoCard","big","playsInline","mention","timestamp","formatTimestamp","timestamps","find","t","AFFILIATES","GOODREADS","AMAZON","BOOK_DEPOSITORY","AFFILIATE_ACTIONS","StyledArrowIcon","ArrowIcon","entries","affiliateAbbr","label","href","long","$export","$find","forced","Array","P","F","callbackfn","this","arguments","undefined","$values","it","Link","GatsbyLink","Wrapper","children","flip","thin","PlayIcon","className","viewBox","d","YouTubePlayerConfig","youtube","playerVars","rel","controls","autoplay","StyledVideoCard","COLOR","BACKGROUND_DARK","StyledPlayButton","button","StyledPlayIcon","BACKGROUND_LIGHT","StyledDetails","StyledTimestamp","XS","StyledDatePublished","time","StyledH","StyledBookContentsWrapper","isStars","XXS","useState","playVideo","setPlayVideo","featuredBookCount","lightVibrant","color","vibrant","AspectRatioWrapper","url","youtubeId","unformatTimestamp","config","width","height","onClick","e","preventDefault","fluid","w200","w350","ownedBy","datePublished","formatViewCount","viewCount"],"mappings":"wiBAWA,IAAMA,EAAgBC,IAAOC,IAAV,KAIbC,EAAaF,YAAOG,IAAPH,CAAH,IACDI,IAAKC,KAAKC,EAErBC,IAAOC,EAHK,MAwCDC,IAxBuB,SAAC,GAAD,IAAGC,EAAH,EAAGA,MAAOC,EAAV,EAAUA,cAAeC,EAAzB,EAAyBA,UAAzB,OACpC,kBAACb,EAAD,KACE,kBAACG,EAAD,CAAYW,MAAI,GACbH,EAAMI,KACL,SAACC,GACC,IAAMC,EAAWJ,EACbA,IAAcG,EAAKE,KACnBN,GAAiBA,EAAcO,SAASH,EAAKE,MAEjD,OACE,kBAAC,IAAD,CAAUE,IAAKJ,EAAKK,GAAIC,KAAM,EAAGC,UAAW,EAAGC,UAAW,GACxD,kBAAC,IAAD,CACER,KAAMA,EACNC,SAAUA,EACVQ,YAAaZ,IAAcG,EAAKE,e,ucCtChD,IAAMQ,EAAczB,YAAO0B,IAAP1B,CAAH,KAIX2B,EAAe3B,YAAO0B,IAAP1B,CAAH,KAmBH4B,EAboB,SAAC,GAAD,IAAGC,EAAH,EAAGA,MAAOC,EAAV,EAAUA,OAAQC,EAAlB,EAAkBA,QAAlB,OACjC,oCACE,kBAACN,EAAD,CAAaO,GAAG,KAAKC,KAAK,MAAMC,YAAU,GACvCL,GAEH,kBAACF,EAAD,CAAcK,GAAG,KAAKC,KAAK,KAA3B,MACMH,GAGLC,GAAW,kBAACI,EAAA,EAAD,CAAYC,IAAKL,M,02BCjBjC,IAAMM,EAAkBrC,IAAOsC,OAAV,IAMFC,IAAcjC,EAE7BkC,IAAUC,EARO,KAYjBlC,IAAOC,EAZU,IAaDkC,YAAKC,IAAeC,GAAKC,IAAaD,EAAIE,IAAIF,KAE9DrC,IAAOwC,GAfU,IAgBDL,YAAKC,IAAeK,IAAMH,IAAaG,GAAKF,IAAIE,OAI9DC,EAAYjD,YAAOkD,IAAPlD,CAAH,IAKXmD,IAAU3C,EALC,MAuCA4C,EA3BoB,SAAC,GAAD,IAAGC,EAAH,EAAGA,MAAOC,EAAV,EAAUA,WAAV,OACjC,kBAACjB,EAAD,CAAiBkB,MAAO,CAAEC,WAAYH,EAAMI,OAAOC,QACjD,kBAACT,EAAD,CACEU,MAAO,CAAC,OAAD,UAEAN,EAAMO,gBAAgBC,KAFtB,CAGHC,MAAO,gBAAeC,IAAWC,EAAI,GAAhC,QAHF,iBAMAX,EAAMO,gBAAgBK,KANtB,CAOHH,MAAO,eACLC,IAAWC,EADR,wBAEkBD,IAAWnB,EAAI,GAFjC,QAPF,iBAYAS,EAAMO,gBAAgBM,KAZtB,CAaHJ,MAAO,eAAeC,IAAWnB,EAA5B,SAGTW,MAAO,CACL,iBAAkBD,GAAc,KAAO,KAAKa,QAAQ,IAEtDC,gBAAiBf,EAAMI,OAAOY,c,iIC1DpC,IAAMC,EAAmBtE,IAAOC,IAAV,KAmBPsE,EAbqB,SAAC,GAAD,IAAGC,EAAH,EAAGA,QAASC,EAAZ,EAAYA,KAAZ,OAClC,kBAACH,EAAD,KACGE,GACC,6BAASjB,MAAO,CAAEmB,SAAU,WAC1B,gDACCF,GAIJC,GAAQ,yBAAKE,wBAAyB,CAAEC,OAAQH,OCpB/CI,G,kDAAiB,CACrBC,KAAM,OACNC,MAAO,QACPC,IAAK,Y,2SCIP,IAAMC,EAAWjF,IAAOkF,GAAV,IAEC9E,IAAKC,KAAKC,GAOnB6E,EAAWnF,IAAOoF,GAAV,KA0BCC,EAnBmB,SAAC,GAAa,IAAXC,EAAW,EAAXA,KACnC,IAAKA,GAAwB,IAAhBA,EAAKC,OAAc,OAAO,KAEvC,IAAMC,EDpByB,SAC/BF,GAKA,IAAMG,EAAY,GAelB,OAbAH,EAAKI,SAAQ,SAACC,GACZ,IAAMC,EAAQD,EAAIE,MAAM,KACxB,GAAqB,IAAjBD,EAAML,OAAV,CAEA,IAAMO,EAASF,EAAM,GAEfG,EAAQH,EAAMI,MAAM,GAAGC,KAAK,KAElC,IAAKR,EAAUK,GAAS,OAAQL,EAAUK,GAAU,CAACC,GAErDN,EAAUK,GAAQI,KAAKH,OAGlBI,OAAOC,KAAKvB,GAChBwB,QAAO,SAACC,GAAD,OAAOb,EAAUa,MACxBxF,KAAI,SAACgF,GAAD,MAAa,CAChBA,OAAQjB,EAAeiB,GACvBS,OAAQd,EAAUK,OCLJU,CAAkBlB,GAEpC,OACE,kBAACL,EAAD,KACGO,EAAU1E,KAAI,gBAAGgF,EAAH,EAAGA,OAAQS,EAAX,EAAWA,OAAX,OACb,kBAACpB,EAAD,CAAUhE,IAAK2E,GACb,gCAASA,GADX,MAEGS,EAAOzF,KAAI,SAACiF,GAAD,OACV,0BAAM5E,IAAK4E,GAAQA,Y,4PC1B/B,IAAMU,EAAWzG,IAAO0G,GAAV,IACCtG,IAAKC,KAAKC,EACRF,IAAKuG,OAAOC,MAGvBC,EAAW7G,IAAO8G,GAAV,IACC1G,IAAKC,KAAKC,GAyEVyG,EA1DmB,SAAC,GAAD,IAChCC,EADgC,EAChCA,UACAC,EAFgC,EAEhCA,kBACAC,EAHgC,EAGhCA,UACA5B,EAJgC,EAIhCA,KACA6B,EALgC,EAKhCA,UACAC,EANgC,EAMhCA,UACAC,EAPgC,EAOhCA,aAPgC,OAShC,6BACE,4BACGL,GACC,oCACE,kBAACP,EAAD,mBACA,kBAACI,EAAD,KAAWG,IAGdC,GACC,oCACE,kBAACR,EAAD,uBACA,kBAACI,EAAD,KAAWS,YAAWL,KAGzBC,GACC,oCACE,kBAACT,EAAD,kBACA,kBAACI,EAAD,KAAWK,IAIf,kBAAC,EAAD,CAAU5B,KAAMA,KAGlB,4BACG6B,EAAU5B,OAAS,GAClB,oCACE,kBAACkB,EAAD,kBACA,kBAACI,EAAD,KACGU,YAAgBJ,EAAUA,EAAU5B,OAAS,GAAG,MAItD6B,GACC,oCACE,kBAACX,EAAD,mBACA,kBAACI,EAAD,KAAWU,YAAgBH,KAG9BC,GACC,oCACE,kBAACZ,EAAD,sBACA,kBAACI,EAAD,KAAWU,YAAgBF,Q,ifCrDrC,IAAMG,GAAaxH,IAAOyH,MAAV,KACZtE,IAAU3C,EADE,KAIAkC,YAAKI,IAAIF,IAGrBrC,IAAOwC,GAPK,KAQAL,YAAKI,IAAIE,MAInB0E,GAAkB1H,IAAOC,IAAV,MA+HR0H,GAAQ,aA2BNC,UAjImB,SAAC,GAG7B,QAFJC,KAAQ9G,EAEJ,EAFIA,KAAM+G,EAEV,EAFUA,qBAAsBC,EAEhC,EAFgCA,kBACpCC,EACI,EADJA,SAEMC,EAAoBC,YACxBJ,GAEIK,EAAiBD,YAAeH,GAChCK,EAAerH,EAAKqH,aAE1B,OACE,kBAACC,EAAA,EAAD,CAAQL,SAAUA,GAChB,kBAACM,EAAA,EAAD,CAAUC,GAAIC,IAAMC,OAApB,wBAEA,kBAACtI,EAAA,EAAD,CAAMU,MAAI,GACR,kBAAC6H,EAAA,EAAD,CACE1G,GAAI0F,GACJiB,KAAK,MACLC,UAAU,MACVC,aAAa,SACbC,aAAa,SACbC,cAAc,UAEd,kBAAC,EAAD,CACElH,MAAOd,EAAKc,MACZC,OAAQf,EAAKe,OACbC,QAAShB,EAAKgB,WAIlB,kBAAC2G,EAAA,EAAD,CAAUG,aAAa,MAAMC,aAAa,MAAMC,cAAc,OAC5D,kBAAC,EAAD,CAAW1F,MAAOtC,EAAKsC,MAAOC,WAAYvC,EAAKuC,cAGjD,kBAACoF,EAAA,EAAD,CACE1G,GAAIwF,GACJlG,UAAW,EACXwH,aAAa,MACbC,cAAc,MACdC,cACE,EACAC,KAAKC,MAAMjB,EAAkB1C,OAAS4C,EAAe5C,QAAU,IAGjE,kBAAC,EAAD,CACEyB,UAAWjG,EAAKiG,UAChBC,kBAAmBlG,EAAKkG,kBACxBC,UAAWnG,EAAKmG,UAChB5B,KAAMvE,EAAKuE,KACX6B,UAAWpG,EAAKoG,UAChBC,UAAWrG,EAAKqG,UAChBC,aAActG,EAAKsG,eAGrB,kBAAC8B,GAAA,EAAD,CAAgBC,MAAOrI,EAAKqI,SAG9B,kBAACV,EAAA,EAAD,CAAUG,aAAa,OAAOC,aAAa,OAAOC,cAAc,QAC9D,kBAAC,EAAD,CAAYvE,QAASzD,EAAKyD,QAASC,KAAM1D,EAAK0D,QAG/C0D,EAAerH,KAAI,SAACuI,GAAD,OAClB,kBAACX,EAAA,EAAD,CACEvH,IAAKkI,EAAMjI,GACXC,KAAM,EACNC,UAAW,EACXC,UAAW,EACX+H,WAAY,GAEZ,kBAACC,EAAA,EAAD,CAAWF,MAAOA,EAAwBG,KAAG,EAACC,aAAW,QAI5DxB,EAAkBnH,KAAI,SAAC4I,GACtB,IAAMC,EAAYC,YAChBF,EAAQG,WAAWC,MAAK,SAACC,GAAD,OAAOA,EAAEhJ,MAAQgJ,EAAEhJ,KAAKK,KAAOL,EAAKK,MAAI2I,GAGlE,OACE,kBAACrB,EAAA,EAAD,CACEvH,IAAKuI,EAAQtI,GACbC,KAAM,EACNC,UAAW,EACXC,UAAW,EACX+H,WAAY,GAEZ,kBAACC,EAAA,EAAD,CACEF,MAAOK,EACPC,UAAWA,EACXH,KAAG,EACHC,aAAW,SAOrB,kBAAChJ,EAAA,EAAD,CAAcC,MAAO0H,O,iHC/Jd4B,G,wCAAa,CACxBC,UAAW,KACXC,OAAQ,OACRC,gBAAiB,O,+VCInB,IAAMC,IAAiB,MACpBJ,EAAWC,WAAY,mBADH,EAEpBD,EAAWE,QAAS,gBAFA,EAGpBF,EAAWG,iBAAkB,yBAHT,GAMjBhF,EAAWnF,IAAOoF,GAAV,IACChF,IAAKC,KAAKC,EAErB6C,IAAU3C,EAHA,MAQR6J,EAAkBrK,YAAOsK,IAAPtK,CAAH,KAmBNmJ,IAbyB,SAAC,GAAD,IAAGC,EAAH,EAAGA,MAAH,OACtC,4BACGjD,OAAOoE,QAAQH,GAAmBtJ,KAAI,gBAAE0J,EAAF,KAAiBC,EAAjB,YACrC,kBAACtF,EAAD,CAAUhE,IAAKqJ,GACb,uBAAGE,KAAMtB,EAAMuB,KAAKH,IAClB,kBAACH,EAAD,MACCI,U,kCCjCX,IAAIG,EAAU,EAAQ,QAClBC,EAAQ,EAAQ,OAAR,CAA4B,GAEpCC,GAAS,EADH,QAGC,IAAIC,MAAM,GAAM,MAAE,WAAcD,GAAS,KACpDF,EAAQA,EAAQI,EAAIJ,EAAQK,EAAIH,EAAQ,QAAS,CAC/ChB,KAAM,SAAcoB,GAClB,OAAOL,EAAMM,KAAMD,EAAYE,UAAU7F,OAAS,EAAI6F,UAAU,QAAKC,MAGzE,EAAQ,OAAR,CATU,S,qBCHV,IAAIT,EAAU,EAAQ,QAClBU,EAAU,EAAQ,OAAR,EAA8B,GAE5CV,EAAQA,EAAQtK,EAAG,SAAU,CAC3BiG,OAAQ,SAAgBgF,GACtB,OAAOD,EAAQC,O,gpBCHnB,IA+BeC,EA/BFxL,YAAOyL,IAAPzL,CAAH,K,wKCIV,IAAMD,EAAgBC,YAAO0L,IAAP1L,CAAH,KAqBJsI,IATmB,SAAC,GAAD,IAAGC,EAAH,EAAGA,GAAIoD,EAAP,EAAOA,SAAP,OAChC,kBAAC5L,EAAD,KACE,kBAAC,EAAD,CAAMwI,GAAIA,GACR,kBAAC+B,EAAA,EAAD,CAAWsB,MAAI,EAACC,MAAI,IACnBF,M,yNCXQG,EANmB,SAAC,GAAD,IAAGC,EAAH,EAAGA,UAAH,OAChC,yBAAKC,QAAQ,YAAYD,UAAWA,GAClC,0BAAME,EAAE,qG,y4CCOZ,IAAMC,EAAsB,CAC1BC,QAAS,CACPC,WAAY,CACVC,IAAK,EACLC,SAAU,EACVC,SAAU,KAKVC,EAAkBxM,YAAOwL,IAAPxL,CAAH,IAMLyM,IAAMC,gBACHnK,IAAcjC,GAG3BqM,EAAmB3M,IAAO4M,OAAV,KAOhBC,EAAiB7M,YAAO8L,EAAP9L,CAAH,IAEVyM,IAAMK,kBAIV7J,EAAYjD,YAAOkD,IAAPlD,CAAH,KAIT+M,EAAgB/M,IAAOC,IAAV,KASb+M,EAAkBhN,IAAOsG,EAAV,IACNlG,IAAKC,KAAKC,GAInBkH,EAAaxH,IAAOsG,EAAV,IAIDlG,IAAKC,KAAK4M,IAKnBC,EAAsBlN,IAAOmN,KAAV,KAInBC,EAAUpN,YAAO0B,IAAP1B,CAAH,KAQPqN,EAA4BrN,IAAOC,IAAV,KAChB,qBAAGqN,QACJlN,IAAKC,KAAKkN,IAAMnN,IAAKC,KAAK4M,MAC5B,qBAAGK,QAAiC,GAAM,MA8GvC/D,IAlGoB,SAAC,GAM9B,IALJF,EAKI,EALJA,MACArI,EAII,EAJJA,SACA2I,EAGI,EAHJA,UACAH,EAEI,EAFJA,IACAC,EACI,EADJA,YACI,EAC8B+D,oBAAS,GAApCC,EADH,KACcC,EADd,KAEEC,GAAqBtE,EAAMQ,YAAc,IAAIxD,QACjD,SAAC0D,GAAD,OAAOA,EAAEhJ,MAAQgJ,EAAEhJ,KAAKK,MACxBmE,OAEF,OACE,kBAACiH,EAAD,CACEjE,GAAIoB,EAAeN,EAAMpI,KAAZ,OAAuB0I,EAAcN,EAAMpI,KACxDsC,MACE,CACEC,WAAYxC,GAAYqI,EAAMhG,MAAMI,OAAOmK,aAC3CC,MAAO7M,GAAYqI,EAAMhG,MAAMI,OAAOY,UACtC,kBAAmBgF,EAAMhG,MAAMI,OAAOqK,UAI1C,kBAACC,EAAA,EAAD,CAAoBxK,MAAO,CAAEa,gBAAiBiF,EAAMhG,MAAMI,OAAOC,QAC9D+J,EACC,kBAAC,IAAD,CACEO,IAAG,mCACD3E,EAAM4E,WACLtE,GAAa,MAAMuE,YAAkBvE,IACxCwE,OAAQjC,EACRkC,MAAM,OACNC,OAAO,SAGT,6BACG5E,GACC,kBAACkD,EAAD,CACE2B,QAAS,SAACC,GACRA,EAAEC,iBACFd,GAAa,KAGf,kBAACb,EAAD,OAGJ,kBAAC5J,EAAD,CACEwL,MACEjF,EACI,CAAC,OAAD,UAEOH,EAAMhG,MAAMO,gBAAgB8K,KAFnC,CAGI5K,MAAO,gBAAeC,IAAWC,EAAI,GAAhC,QAHT,iBAMOqF,EAAMhG,MAAMO,gBAAgB+K,KANnC,CAOI7K,MAAO,eAAeC,IAAWC,EAA5B,SAGTqF,EAAMhG,MAAMO,gBAAgB8K,SAM1C,kBAAC3B,EAAD,KACE,6BACGpD,GACC,kBAACqD,EAAD,oBAA8BrD,EAA9B,OAEF,kBAACyD,EAAD,CAASpL,GAAG,KAAKC,KAAK,KACnBoH,EAAMxH,OAGT,kBAACwL,EAAD,CAA2BC,UAAWjE,EAAMuF,SACzCvF,EAAMuF,QACHvF,EAAMuF,QAAQ7M,SACZ,kBAACI,EAAA,EAAD,CAAYC,IAAKiH,EAAMuF,QAAQ7M,WAEhC4H,GACDgE,EAAoB,GAClB,iDACaA,EADb,QAEGA,EAAoB,GAAK,OAKtC,kBAACnG,EAAD,KACE,kBAAC0F,EAAD,KACG3F,YAAgB8B,EAAMwF,gBAEzB,6BAAMC,YAAgBzF,EAAM0F","file":"component---src-views-book-page-index-tsx-b097d2d455a4c8324ee3.js","sourcesContent":["import React from 'react'\nimport styled from 'styled-components'\n\nimport Grid from 'components/Grid'\nimport GridItem from 'components/Grid/GridItem'\nimport { FONT } from 'styles/tokens'\nimport { screen } from 'styles/responsive'\n\nimport { BookCardType } from 'types/book'\nimport BookCard from 'components/cards/BookCard'\n\nconst StyledWrapper = styled.div`\n  margin: 1.5em 0;\n`\n\nconst StyledGrid = styled(Grid)`\n  font-size: ${FONT.SIZE.S};\n\n  ${screen.l`\n    > *:nth-last-child(1) {\n      display: none;\n    }\n  `}\n`\n\ninterface Props {\n  books: BookCardType[]\n  featuredSlugs?: string[]\n  ownedSlug?: string\n}\n\nconst RelatedBooks: React.FC<Props> = ({ books, featuredSlugs, ownedSlug }) => (\n  <StyledWrapper>\n    <StyledGrid full>\n      {books.map(\n        (book: BookCardType): React.ReactNode => {\n          const featured = ownedSlug\n            ? ownedSlug === book.slug\n            : featuredSlugs && featuredSlugs.includes(book.slug)\n\n          return (\n            <GridItem key={book.id} span={1} spanFromM={3} spanFromL={2}>\n              <BookCard\n                book={book}\n                featured={featured}\n                hideDetails={ownedSlug === book.slug}\n              />\n            </GridItem>\n          )\n        }\n      )}\n    </StyledGrid>\n  </StyledWrapper>\n)\n\nexport default RelatedBooks\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport { Book } from 'types/book'\nimport StarRating from 'components/StarRating'\nimport H from 'components/H'\n\nconst StyledTitle = styled(H)`\n  margin: 0;\n`\n\nconst StyledAuthor = styled(H)`\n  margin: 0.5em 0 1em;\n`\n\ntype Props = Pick<Book, 'title' | 'author' | 'rating7'>\n\nconst BookTitle: React.FC<Props> = ({ title, author, rating7 }) => (\n  <>\n    <StyledTitle as=\"h2\" size=\"XXL\" decorative>\n      {title}\n    </StyledTitle>\n    <StyledAuthor as=\"h2\" size=\"M\">\n      by {author}\n    </StyledAuthor>\n\n    {rating7 && <StarRating of7={rating7} />}\n  </>\n)\n\nexport default BookTitle\n","import React from 'react'\nimport styled from 'styled-components'\nimport Img from 'gatsby-image'\n\nimport { Book } from 'types/book'\nimport { BORDER_RADIUS, BREAKPOINT } from 'styles/tokens'\nimport { screen, screenMax, screenMin } from 'styles/responsive'\nimport { toVW, MARGIN_COLUMNS, COLUMN_WIDTH, GAP } from 'styles/layout'\n\nconst StyledBookImage = styled.figure`\n  position: relative;\n  margin: 0;\n  box-sizing: border-box;\n  padding: 1em 0;\n  width: 100%;\n  border-radius: ${BORDER_RADIUS.S};\n\n  ${screenMax.m`\n    text-align: center;\n  `}\n\n  ${screen.l`\n    padding-left: ${toVW(MARGIN_COLUMNS.L * (COLUMN_WIDTH.L + GAP.L))};\n  `}\n  ${screen.xl`\n    padding-left: ${toVW(MARGIN_COLUMNS.XL * (COLUMN_WIDTH.XL + GAP.XL))};\n  `}\n`\n\nconst StyledImg = styled(Img)`\n  box-shadow: 0 0.4em 1em rgba(0, 0, 0, 0.2), 0 0 0.6em rgba(0, 0, 0, 0.1);\n  vertical-align: bottom;\n  transform: scale(var(--book-scale));\n\n  ${screenMin.l`\n    transform-origin: 0% 50%;\n  `}\n`\n\ntype Props = Pick<Book, 'image' | 'bookHeight'>\n\nconst BookImage: React.FC<Props> = ({ image, bookHeight }) => (\n  <StyledBookImage style={{ background: image.colors.muted }}>\n    <StyledImg\n      fixed={[\n        {\n          ...image.childImageSharp.h200,\n          media: `(max-width: ${BREAKPOINT.M - 1}px)`,\n        },\n        {\n          ...image.childImageSharp.h300,\n          media: `(min-width: ${\n            BREAKPOINT.M\n          }px) and (max-width: ${BREAKPOINT.L - 1}px)`,\n        },\n        {\n          ...image.childImageSharp.h400,\n          media: `(min-width: ${BREAKPOINT.L}px)`,\n        },\n      ]}\n      style={{\n        '--book-scale': ((bookHeight || 198) / 220).toFixed(2),\n      }}\n      backgroundColor={image.colors.darkMuted}\n    />\n  </StyledBookImage>\n)\n\nexport default BookImage\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport { Book } from 'types/book'\n\nconst StyledBookReview = styled.div`\n  margin-top: 1em;\n`\n\ntype Props = Pick<Book, 'summary' | 'html'>\n\nconst BookReview: React.FC<Props> = ({ summary, html }) => (\n  <StyledBookReview>\n    {summary && (\n      <details style={{ fontSize: '0.75em' }}>\n        <summary>Book sumary</summary>\n        {summary}\n      </details>\n    )}\n\n    {html && <div dangerouslySetInnerHTML={{ __html: html }} />}\n  </StyledBookReview>\n)\n\nexport default BookReview\n","const tagPrefixNames = {\n  type: 'Type',\n  genre: 'Genre',\n  sub: 'Subject',\n}\n\nexport const splitTagsByPrefix = (\n  tags: string[]\n): {\n  prefix: string\n  values: string[]\n}[] => {\n  const resultMap = {}\n\n  tags.forEach((tag) => {\n    const parts = tag.split('-')\n    if (parts.length === 1) return\n\n    const prefix = parts[0]\n\n    const value = parts.slice(1).join('-')\n\n    if (!resultMap[prefix]) return (resultMap[prefix] = [value])\n\n    resultMap[prefix].push(value)\n  })\n\n  return Object.keys(tagPrefixNames)\n    .filter((p) => resultMap[p])\n    .map((prefix) => ({\n      prefix: tagPrefixNames[prefix],\n      values: resultMap[prefix],\n    }))\n}\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport { Book } from 'types/book'\nimport { FONT } from 'styles/tokens'\nimport { splitTagsByPrefix } from './utils'\n\nconst StyledOl = styled.ol`\n  margin: 0;\n  font-size: ${FONT.SIZE.S};\n\n  span + span:before {\n    content: ', ';\n  }\n`\n\nconst StyledLi = styled.li`\n  line-height: 1.25;\n  margin: 0.5em 0;\n`\n\ntype Props = Pick<Book, 'tags'>\n\nconst TagsList: React.FC<Props> = ({ tags }) => {\n  if (!tags || tags.length === 0) return null\n\n  const splitTags = splitTagsByPrefix(tags)\n\n  return (\n    <StyledOl>\n      {splitTags.map(({ prefix, values }) => (\n        <StyledLi key={prefix}>\n          <strong>{prefix}</strong> &ndash; {}\n          {values.map((value) => (\n            <span key={value}>{value}</span>\n          ))}\n        </StyledLi>\n      ))}\n    </StyledOl>\n  )\n}\n\nexport default TagsList\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport { Book } from 'types/book'\nimport { shortFormatDate, formatYear } from 'utils/formatting/time'\nimport { FONT } from 'styles/tokens'\nimport TagsList from './TagsList'\n\nconst StyledDt = styled.dt`\n  font-size: ${FONT.SIZE.S};\n  font-weight: ${FONT.WEIGHT.BOLD};\n`\n\nconst StyledDd = styled.dd`\n  font-size: ${FONT.SIZE.S};\n  margin: 0 0 1em;\n`\n\ntype Props = Pick<\n  Book,\n  | 'pageCount'\n  | 'dateBookPublished'\n  | 'publisher'\n  | 'tags'\n  | 'readDates'\n  | 'dateRated'\n  | 'dateReviewed'\n>\n\nconst BookMeta: React.FC<Props> = ({\n  pageCount,\n  dateBookPublished,\n  publisher,\n  tags,\n  readDates,\n  dateRated,\n  dateReviewed,\n}) => (\n  <div>\n    <dl>\n      {pageCount && (\n        <>\n          <StyledDt>Page count</StyledDt>\n          <StyledDd>{pageCount}</StyledDd>\n        </>\n      )}\n      {dateBookPublished && (\n        <>\n          <StyledDt>Year published</StyledDt>\n          <StyledDd>{formatYear(dateBookPublished)}</StyledDd>\n        </>\n      )}\n      {publisher && (\n        <>\n          <StyledDt>Publisher</StyledDt>\n          <StyledDd>{publisher}</StyledDd>\n        </>\n      )}\n\n      <TagsList tags={tags} />\n    </dl>\n\n    <dl>\n      {readDates.length > 0 && (\n        <>\n          <StyledDt>Date read</StyledDt>\n          <StyledDd>\n            {shortFormatDate(readDates[readDates.length - 1][1])}\n          </StyledDd>\n        </>\n      )}\n      {dateRated && (\n        <>\n          <StyledDt>Date rated</StyledDt>\n          <StyledDd>{shortFormatDate(dateRated)}</StyledDd>\n        </>\n      )}\n      {dateReviewed && (\n        <>\n          <StyledDt>Date reviewed</StyledDt>\n          <StyledDd>{shortFormatDate(dateReviewed)}</StyledDd>\n        </>\n      )}\n    </dl>\n  </div>\n)\n\nexport default BookMeta\n","import React from 'react'\nimport styled from 'styled-components'\nimport { graphql } from 'gatsby'\n\nimport { PageProps } from 'types/page'\nimport { Book } from 'types/book'\nimport { VideoSnapshot } from 'types/video'\nimport { normalizeArray } from 'utils/graphql/normalize'\nimport PATHS from 'routes/paths'\nimport Layout from 'Layout'\nimport Grid from 'components/Grid'\nimport GridItem from 'components/Grid/GridItem'\nimport BackLink from 'components/links/BackLink'\nimport VideoCard from 'components/cards/VideoCard'\nimport RelatedBooks from 'components/RelatedBooks'\nimport { screen, screenMin } from 'styles/responsive'\nimport { GAP, toVW } from 'styles/layout'\nimport { formatTimestamp } from 'utils/formatting/time'\n\nimport BookTitle from './BookTitle'\nimport BookImage from './BookImage'\nimport BookReview from './BookReview'\nimport BookMeta from './BookMeta'\nimport BookAffiliates from './BookAffiliates'\nimport { VideoCardType } from 'types/video'\nimport { BookCardType } from 'types/book'\n\nconst StyledMeta = styled.aside`\n  ${screenMin.l`\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    grid-gap: ${toVW(GAP.L)};\n  `}\n\n  ${screen.xl`\n    grid-gap: ${toVW(GAP.XL)};\n  `}\n`\n\nconst StyledBookTitle = styled.div`\n  align-self: end;\n`\n\ninterface Props extends PageProps {\n  data: {\n    book: Book\n    timestampMentionData: {\n      edges: {\n        node: VideoSnapshot\n      }[]\n    }\n    featuredVideoData: {\n      edges: {\n        node: VideoSnapshot\n      }[]\n    }\n    relatedbooksData: {\n      edges: {\n        node: BookCardType\n      }[]\n    }\n  }\n}\n\nconst BookPage: React.FC<Props> = ({\n  data: { book, timestampMentionData, featuredVideoData },\n  location,\n}) => {\n  const timestampMentions = normalizeArray(\n    timestampMentionData\n  ) as VideoSnapshot[]\n  const featuredVideos = normalizeArray(featuredVideoData) as VideoSnapshot[]\n  const relatedBooks = book.relatedBooks as BookCardType[]\n\n  return (\n    <Layout location={location}>\n      <BackLink to={PATHS.BOOKS}>Back to book reviews</BackLink>\n\n      <Grid full>\n        <GridItem\n          as={StyledBookTitle}\n          rows=\"2/3\"\n          rowsFromM=\"1/2\"\n          columnsFromM=\"7 / 12\"\n          columnsFromL=\"8 / 14\"\n          columnsFromXL=\"9 / 15\"\n        >\n          <BookTitle\n            title={book.title}\n            author={book.author}\n            rating7={book.rating7}\n          />\n        </GridItem>\n\n        <GridItem columnsFromM=\"1/7\" columnsFromL=\"1/8\" columnsFromXL=\"1/9\">\n          <BookImage image={book.image} bookHeight={book.bookHeight} />\n        </GridItem>\n\n        <GridItem\n          as={StyledMeta}\n          spanFromM={4}\n          columnsFromL=\"2/8\"\n          columnsFromXL=\"3/9\"\n          spanRowsFromM={\n            2 +\n            Math.ceil((timestampMentions.length + featuredVideos.length) / 2)\n          }\n        >\n          <BookMeta\n            pageCount={book.pageCount}\n            dateBookPublished={book.dateBookPublished}\n            publisher={book.publisher}\n            tags={book.tags}\n            readDates={book.readDates}\n            dateRated={book.dateRated}\n            dateReviewed={book.dateReviewed}\n          />\n\n          <BookAffiliates links={book.links} />\n        </GridItem>\n\n        <GridItem columnsFromM=\"5/13\" columnsFromL=\"8/15\" columnsFromXL=\"9/15\">\n          <BookReview summary={book.summary} html={book.html} />\n        </GridItem>\n\n        {featuredVideos.map((video) => (\n          <GridItem\n            key={video.id}\n            span={1}\n            spanFromM={4}\n            spanFromL={3}\n            spanFromXL={4}\n          >\n            <VideoCard video={video as VideoCardType} big playsInline />\n          </GridItem>\n        ))}\n\n        {timestampMentions.map((mention) => {\n          const timestamp = formatTimestamp(\n            mention.timestamps.find((t) => t.book && t.book.id === book.id).t\n          )\n\n          return (\n            <GridItem\n              key={mention.id}\n              span={1}\n              spanFromM={4}\n              spanFromL={3}\n              spanFromXL={4}\n            >\n              <VideoCard\n                video={mention as VideoCardType}\n                timestamp={timestamp}\n                big\n                playsInline\n              />\n            </GridItem>\n          )\n        })}\n      </Grid>\n\n      <RelatedBooks books={relatedBooks} />\n    </Layout>\n  )\n}\n\nexport const query = graphql`\n  query BookPage($id: String!) {\n    book: book(id: { eq: $id }) {\n      ...BookFields\n    }\n    timestampMentionData: allVideo(\n      filter: { timestamps: { elemMatch: { book: { id: { eq: $id } } } } }\n    ) {\n      edges {\n        node {\n          ...VideoSnapshotFields\n        }\n      }\n    }\n    featuredVideoData: allVideo(\n      filter: { ownedBy: { id: { eq: $id } } }\n      sort: { fields: datePublished, order: DESC }\n    ) {\n      edges {\n        node {\n          ...VideoSnapshotFields\n        }\n      }\n    }\n  }\n`\n\nexport default BookPage\n","import { makeIsbn10 } from 'utils/formatting/isbn'\n\nexport const AFFILIATES = {\n  GOODREADS: 'gr',\n  AMAZON: 'amzn',\n  BOOK_DEPOSITORY: 'bd',\n}\n\nexport const getLink = (isbn: string, affiliateAbbr: string): string => {\n  if (affiliateAbbr === AFFILIATES.GOODREADS)\n    return `https://www.goodreads.com/search?query=${isbn}`\n\n  if (affiliateAbbr === AFFILIATES.AMAZON)\n    return `https://www.amazon.co.uk/dp/${makeIsbn10(\n      String(isbn)\n    )}?tag=thcdex-21`\n\n  if (affiliateAbbr === AFFILIATES.BOOK_DEPOSITORY)\n    return `https://bookdepository.com/search?searchTerm=${isbn}&a_id=char`\n}\n\nexport const getShortLink = (isbn: string, affiliateAbbr: string): string =>\n  `https://cha.rs/${affiliateAbbr}/${parseInt(isbn)\n    .toString(36)\n    .toUpperCase()}`\n\nexport const getAffiliateLinks = (isbn: string): object => {\n  const long = {}\n  const short = {}\n\n  Object.values(AFFILIATES).forEach((affiliate: string) => {\n    long[affiliate] = getLink(isbn, affiliate)\n    short[affiliate] = getShortLink(isbn, affiliate)\n  })\n\n  return {\n    long,\n    short,\n  }\n}\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport { Book } from 'types/book'\nimport { AFFILIATES } from 'utils/urls/affiliates'\nimport { FONT } from 'styles/tokens'\nimport { screenMin } from 'styles/responsive'\nimport ArrowIcon from 'components/icons/ArrowIcon'\n\nconst AFFILIATE_ACTIONS = {\n  [AFFILIATES.GOODREADS]: 'See on Goodreads',\n  [AFFILIATES.AMAZON]: 'Buy on Amazon',\n  [AFFILIATES.BOOK_DEPOSITORY]: 'Buy on Book Depository',\n}\n\nconst StyledLi = styled.li`\n  font-size: ${FONT.SIZE.S};\n\n  ${screenMin.l`\n    margin-left: -1.5em;\n  `}\n`\n\nconst StyledArrowIcon = styled(ArrowIcon)`\n  margin: 0 0.75em 0 0;\n`\n\ntype Props = Pick<Book, 'links'>\n\nconst BookAffiliates: React.FC<Props> = ({ links }) => (\n  <ol>\n    {Object.entries(AFFILIATE_ACTIONS).map(([affiliateAbbr, label]) => (\n      <StyledLi key={affiliateAbbr}>\n        <a href={links.long[affiliateAbbr]}>\n          <StyledArrowIcon />\n          {label}\n        </a>\n      </StyledLi>\n    ))}\n  </ol>\n)\n\nexport default BookAffiliates\n","'use strict';\n// 22.1.3.8 Array.prototype.find(predicate, thisArg = undefined)\nvar $export = require('./_export');\nvar $find = require('./_array-methods')(5);\nvar KEY = 'find';\nvar forced = true;\n// Shouldn't skip holes\nif (KEY in []) Array(1)[KEY](function () { forced = false; });\n$export($export.P + $export.F * forced, 'Array', {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\nrequire('./_add-to-unscopables')(KEY);\n","// https://github.com/tc39/proposal-object-values-entries\nvar $export = require('./_export');\nvar $values = require('./_object-to-array')(false);\n\n$export($export.S, 'Object', {\n  values: function values(it) {\n    return $values(it);\n  }\n});\n","import styled from 'styled-components'\nimport { Link as GatsbyLink } from 'gatsby'\n\nconst Link = styled(GatsbyLink)`\n  position: relative;\n  outline: none;\n\n  &:focus {\n    outline: none;\n  }\n\n  &:active {\n    outline: none;\n  }\n\n  &:before {\n    content: '';\n    position: absolute;\n    top: -0.25em;\n    left: -0.5em;\n    bottom: -0.25em;\n    right: -0.5em;\n    outline: inherit;\n  }\n\n  &:focus:before {\n    outline: 1px dashed var(--secondary-color);\n  }\n\n  &:active:before {\n    outline: 1px dashed var(--primary-color);\n  }\n`\n\nexport default Link\n","import React from 'react'\nimport styled from 'styled-components'\n\nimport Wrapper from 'components/Wrapper'\nimport ArrowIcon from 'components/icons/ArrowIcon'\nimport Link from 'components/links/Link'\n\nconst StyledWrapper = styled(Wrapper)`\n  & {\n    margin-top: 1em;\n    margin-bottom: 1em;\n  }\n`\n\ninterface Props {\n  to: string\n  children: React.ReactNode\n}\n\nconst BackLink: React.FC<Props> = ({ to, children }) => (\n  <StyledWrapper>\n    <Link to={to}>\n      <ArrowIcon flip thin />\n      {children}\n    </Link>\n  </StyledWrapper>\n)\n\nexport default BackLink\n","import React from 'react'\n\ninterface Props {\n  className?: string\n}\n\nconst PlayIcon: React.FC<Props> = ({ className }) => (\n  <svg viewBox=\"0 0 11 14\" className={className}>\n    <path d=\"M9.2,6.2l-7.5-5c-0.5-0.3-1.2,0-1.2,0.6v10.3c0,0.6,0.7,1,1.2,0.6l7.5-5C9.8,7.4,9.8,6.6,9.2,6.2z\" />\n  </svg>\n)\n\nexport default PlayIcon\n","import React, { useState } from 'react'\nimport styled from 'styled-components'\nimport { Link } from 'gatsby'\nimport Img from 'gatsby-image'\nimport YouTubePlayer from 'react-player/lib/players/YouTube'\n\nimport { VideoCardType } from 'types/video'\nimport { shortFormatDate, unformatTimestamp } from 'utils/formatting/time'\nimport { formatViewCount } from 'utils/formatting/numbers'\nimport H from 'components/H'\nimport { COLOR, FONT, BORDER_RADIUS, BREAKPOINT } from 'styles/tokens'\nimport StarRating from 'components/StarRating'\nimport AspectRatioWrapper from 'components/AspectRatioWrapper'\nimport PlayIcon from 'components/icons/PlayIcon'\n\nconst YouTubePlayerConfig = {\n  youtube: {\n    playerVars: {\n      rel: 0,\n      controls: 1,\n      autoplay: 1,\n    },\n  },\n}\n\nconst StyledVideoCard = styled(Link)`\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  margin: 0;\n  overflow: hidden;\n  background: ${COLOR.BACKGROUND_DARK};\n  border-radius: ${BORDER_RADIUS.S};\n`\n\nconst StyledPlayButton = styled.button`\n  position: absolute;\n  z-index: 1;\n  padding: 0.5em 0.6em;\n  line-height: 0;\n`\n\nconst StyledPlayIcon = styled(PlayIcon)`\n  width: 1em;\n  fill: ${COLOR.BACKGROUND_LIGHT};\n  filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.1));\n`\n\nconst StyledImg = styled(Img)`\n  box-shadow: 0 0.2em 0.5em rgba(0, 0, 0, 0.1);\n`\n\nconst StyledDetails = styled.div`\n  padding: 0.5em 0.5em 0.3em;\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  min-height: 4.8em;\n`\n\nconst StyledTimestamp = styled.p`\n  font-size: ${FONT.SIZE.S};\n  margin: 0;\n`\n\nconst StyledMeta = styled.p`\n  display: flex;\n  justify-content: space-between;\n  flex-flow: wrap-reverse;\n  font-size: ${FONT.SIZE.XS};\n  margin: 0;\n  opacity: 0.5;\n`\n\nconst StyledDatePublished = styled.time`\n  margin-right: 0.5em;\n`\n\nconst StyledH = styled(H)`\n  margin: 0;\n`\n\ninterface BookContentsProps {\n  isStars: boolean\n}\n\nconst StyledBookContentsWrapper = styled.div<BookContentsProps>`\n  font-size: ${({ isStars }): string =>\n    isStars ? FONT.SIZE.XXS : FONT.SIZE.XS};\n  margin: ${({ isStars }): number => (isStars ? 0.4 : 0.2)}em 0;\n  opacity: 0.75;\n`\n\ninterface Props {\n  video: VideoCardType\n  featured?: boolean\n  timestamp?: string\n  big?: boolean\n  playsInline?: boolean\n}\n\nconst VideoCard: React.FC<Props> = ({\n  video,\n  featured,\n  timestamp,\n  big,\n  playsInline,\n}) => {\n  const [playVideo, setPlayVideo] = useState(false)\n  const featuredBookCount = (video.timestamps || []).filter(\n    (t) => t.book && t.book.id\n  ).length\n\n  return (\n    <StyledVideoCard\n      to={timestamp ? `${video.slug}?at=${timestamp}` : video.slug}\n      style={\n        {\n          background: featured && video.image.colors.lightVibrant,\n          color: featured && video.image.colors.darkMuted,\n          '--primary-color': video.image.colors.vibrant,\n        } as object\n      }\n    >\n      <AspectRatioWrapper style={{ backgroundColor: video.image.colors.muted }}>\n        {playVideo ? (\n          <YouTubePlayer\n            url={`https://www.youtube.com/watch?v=${\n              video.youtubeId\n            }${timestamp && `&t=${unformatTimestamp(timestamp)}`}`}\n            config={YouTubePlayerConfig}\n            width=\"100%\"\n            height=\"100%\"\n          />\n        ) : (\n          <div>\n            {playsInline && (\n              <StyledPlayButton\n                onClick={(e): void => {\n                  e.preventDefault()\n                  setPlayVideo(true)\n                }}\n              >\n                <StyledPlayIcon />\n              </StyledPlayButton>\n            )}\n            <StyledImg\n              fluid={\n                big\n                  ? [\n                      {\n                        ...video.image.childImageSharp.w200,\n                        media: `(max-width: ${BREAKPOINT.M - 1}px)`,\n                      },\n                      {\n                        ...video.image.childImageSharp.w350,\n                        media: `(min-width: ${BREAKPOINT.M}px)`,\n                      },\n                    ]\n                  : video.image.childImageSharp.w200\n              }\n            />\n          </div>\n        )}\n      </AspectRatioWrapper>\n      <StyledDetails>\n        <div>\n          {timestamp && (\n            <StyledTimestamp>Featured at {timestamp} in</StyledTimestamp>\n          )}\n          <StyledH as=\"h2\" size=\"S\">\n            {video.title}\n          </StyledH>\n\n          <StyledBookContentsWrapper isStars={!!video.ownedBy}>\n            {video.ownedBy\n              ? video.ownedBy.rating7 && (\n                  <StarRating of7={video.ownedBy.rating7} />\n                )\n              : !timestamp &&\n                featuredBookCount > 0 && (\n                  <>\n                    Featuring {featuredBookCount} book\n                    {featuredBookCount > 1 && 's'}\n                  </>\n                )}\n          </StyledBookContentsWrapper>\n        </div>\n        <StyledMeta>\n          <StyledDatePublished>\n            {shortFormatDate(video.datePublished)}\n          </StyledDatePublished>\n          <div>{formatViewCount(video.viewCount)}</div>\n        </StyledMeta>\n      </StyledDetails>\n    </StyledVideoCard>\n  )\n}\n\nexport default VideoCard\n"],"sourceRoot":""}